---
description: Frontend web development guidelines for React, TanStack Router, and TanStack Query
globs: apps/web/**/*
alwaysApply: false
---
# Frontend Web Guidelines

The Kaneo web application is built with React, TanStack Router, TanStack Query, and Vite. This document outlines conventions and patterns for frontend development.

## Framework: React

### Component Structure

Components are organized in `apps/web/src/components/`:

```typescript
// apps/web/src/components/task/task-card.tsx
import { Task } from "@/types/task";

type TaskCardProps = {
  task: Task;
  onUpdate?: (task: Task) => void;
};

export function TaskCard({ task, onUpdate }: TaskCardProps) {
  return (
    <div className="p-4 border rounded-lg">
      <h3>{task.title}</h3>
      {/* ... */}
    </div>
  );
}
```

### Best Practices

1. **TypeScript**: Always type props and component return types
2. **Component naming**: Use PascalCase for component files and exports
3. **Props destructuring**: Destructure props in function parameters
4. **Conditional rendering**: Use ternary or logical operators clearly

```typescript
// Good: Typed component with clear structure
type ButtonProps = {
  variant?: "primary" | "secondary";
  children: React.ReactNode;
  onClick?: () => void;
};

export function Button({ variant = "primary", children, onClick }: ButtonProps) {
  return (
    <button
      className={cn("px-4 py-2", variant === "primary" && "bg-blue-500")}
      onClick={onClick}
    >
      {children}
    </button>
  );
}

// Bad: Untyped, unclear structure
export function Button(props: any) {
  return <button onClick={props.onClick}>{props.children}</button>;
}
```

## Routing: TanStack Router

### File-Based Routing

Routes are defined using file-based routing in `apps/web/src/routes/`:

```typescript
// apps/web/src/routes/tasks/$taskId.tsx
import { createFileRoute } from "@tanstack/react-router";
import { useTask } from "@/hooks/queries/task/use-task";

export const Route = createFileRoute("/tasks/$taskId")({
  component: TaskPage,
});

function TaskPage() {
  const { taskId } = Route.useParams();
  const { data: task } = useTask(taskId);

  if (!task) return <div>Loading...</div>;

  return <div>{task.title}</div>;
}
```

### Route Patterns

- **Layout routes**: Use `_layout.tsx` for shared layouts
- **Auth routes**: Grouped in `auth/` directory
- **Dynamic routes**: Use `$param` syntax for route parameters

```typescript
// Layout route: apps/web/src/routes/_layout.tsx
export const Route = createFileRoute("/_layout")({
  component: Layout,
});

// Dynamic route: apps/web/src/routes/tasks/$taskId.tsx
export const Route = createFileRoute("/tasks/$taskId")({
  component: TaskPage,
});
```

## Data Fetching: TanStack Query

### Query Hooks

Create query hooks in `apps/web/src/hooks/queries/`:

```typescript
// apps/web/src/hooks/queries/task/use-task.ts
import { useQuery } from "@tanstack/react-query";
import { getTask } from "@/fetchers/task/get-task";

export function useTask(taskId: string) {
  return useQuery({
    queryKey: ["task", taskId],
    queryFn: () => getTask(taskId),
  });
}
```

### Mutation Hooks

Create mutation hooks in `apps/web/src/hooks/mutations/`:

```typescript
// apps/web/src/hooks/mutations/task/use-update-task.ts
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { updateTask } from "@/fetchers/task/update-task";
import { toast } from "sonner";

export function useUpdateTask() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: updateTask,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["task"] });
      toast.success("Task updated");
    },
    onError: (error) => {
      toast.error(error.message);
    },
  });
}
```

### Best Practices

1. **Query keys**: Use arrays with consistent structure: `["resource", id]`
2. **Invalidation**: Invalidate related queries after mutations
3. **Error handling**: Use toast notifications for user feedback
4. **Loading states**: Handle loading and error states in components

```typescript
// Good: Proper query with error handling
function TaskPage() {
  const { taskId } = Route.useParams();
  const { data: task, isLoading, error } = useTask(taskId);

  if (isLoading) return <Skeleton />;
  if (error) return <Error message={error.message} />;
  if (!task) return <NotFound />;

  return <TaskDetails task={task} />;
}
```

## Fetchers

API calls are abstracted in `apps/web/src/fetchers/`:

```typescript
// apps/web/src/fetchers/task/get-task.ts
import { apiClient } from "@/lib/api-client";

export async function getTask(taskId: string) {
  const response = await apiClient.get(`/api/task/${taskId}`);
  return response.data;
}
```

### Fetcher Organization

Organize fetchers by feature, mirroring API structure:

```
apps/web/src/fetchers/
├── task/
│   ├── get-task.ts
│   ├── update-task.ts
│   └── create-task.ts
├── project/
│   └── ...
└── workspace/
    └── ...
```

## Styling: Tailwind CSS

Use Tailwind CSS utility classes:

```typescript
<div className="flex items-center gap-4 p-4 bg-white rounded-lg shadow">
  <h2 className="text-xl font-semibold">Title</h2>
</div>
```

### Utility Functions

Use `cn()` utility for conditional classes:

```typescript
import { cn } from "@/lib/cn";

<button
  className={cn(
    "px-4 py-2 rounded",
    isActive && "bg-blue-500 text-white",
    disabled && "opacity-50 cursor-not-allowed",
  )}
>
  Click me
</button>
```

## Authentication

Use Better Auth client for authentication:

```typescript
import { authClient } from "@/lib/auth-client";

// Sign in
await authClient.signIn.email({
  email: "user@example.com",
  password: "password",
});

// Get current user
const session = await authClient.getSession();
```

## File Organization

```
apps/web/src/
├── components/        # React components
│   ├── ui/           # Base UI components
│   └── ...
├── fetchers/         # API call functions
├── hooks/            # Custom React hooks
│   ├── queries/      # TanStack Query hooks
│   └── mutations/    # TanStack Query mutations
├── lib/              # Utility functions
├── routes/           # TanStack Router routes
├── store/            # Global state (Zustand)
├── types/            # TypeScript types
└── main.tsx          # Entry point
```

## Type Safety

Share types between frontend and backend when possible:

```typescript
// apps/web/src/types/task.ts
export type Task = {
  id: string;
  title: string;
  description?: string;
  status: string;
  priority: string;
  dueDate?: string;
  createdAt: string;
};
```

## Error Handling

Handle errors gracefully with user-friendly messages:

```typescript
import { toast } from "sonner";

try {
  await updateTask(taskId, data);
  toast.success("Task updated");
} catch (error) {
  toast.error(
    error instanceof Error ? error.message : "Failed to update task",
  );
}
```
